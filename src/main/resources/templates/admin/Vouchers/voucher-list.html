<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh s√°ch Voucher</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Arial', sans-serif;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #d9534f;
            text-align: center;
            font-weight: bold;
        }
        .btn-primary {
            background-color: #d9534f;
            border: none;
        }
        .btn-primary:hover {
            background-color: #c9302c;
        }
        .table th {
            background-color: #ff7043;
            color: white;
            text-align: center;
            font-size: 14px;
        }
        .table tbody tr:hover {
            background-color: #ffe0b2;
        }
        .alert {
            text-align: center;
            font-weight: bold;
        }
		.countdown-timer {
		    display: inline-block;
		    padding: 5px 10px;
		    font-size: 14px;
		    font-weight: bold;
		    color: white;
		    background: linear-gradient(45deg, #ff416c, #ff4b2b); /* Hi·ªáu ·ª©ng gradient */
		    border-radius: 8px;
		    box-shadow: 0 0 10px rgba(255, 75, 43, 0.6);
		    text-align: center;
		    min-width: 120px;
		    transition: all 0.3s ease;
		}

		.countdown-timer:hover {
		    transform: scale(1.1);
		    box-shadow: 0 0 15px rgba(255, 75, 43, 0.8);
		}

    </style>
</head>
<body>
    <div class="container mt-5">
        <h1>Danh s√°ch Voucher</h1>

        <!-- Hi·ªÉn th·ªã th√¥ng b√°o -->
        <div th:if="${successMessage}" class="alert alert-success">
            <span th:text="${successMessage}"></span>
        </div>
        <div th:if="${errorMessage}" class="alert alert-danger">
            <span th:text="${errorMessage}"></span>
        </div>

        <div class="d-flex justify-content-between align-items-center mb-4">
            <a href="/admin/vouchers/create" class="btn btn-primary">+ Th√™m Voucher</a>
        </div>

        <!-- Tabs ƒë·ªÉ ph√¢n lo·∫°i Voucher -->
        <ul class="nav nav-tabs" id="voucherTabs">
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#ongoing">üîµ ƒêang di·ªÖn ra</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#upcoming">üü¢ S·∫Øp di·ªÖn ra</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#expired">üî¥ ƒê√£ h·∫øt h·∫°n</a>
            </li>
        </ul>

        <div class="tab-content mt-3">
            <!-- Voucher ƒëang di·ªÖn ra -->
            <div id="ongoing" class="tab-pane fade show active">
                <h3 class="text-center text-primary">üîµ Voucher ƒëang di·ªÖn ra</h3>
                <div th:if="${#lists.isEmpty(ongoingVouchers)}" class="alert alert-info text-center">Kh√¥ng c√≥ voucher ƒëang di·ªÖn ra.</div>
                <div class="table-responsive">
                    <table class="table table-bordered table-hover text-center">
						<thead>
				              <tr>
								  <th>Di·ªÖn ra trong</th>
				                  <th>M√£ Voucher</th>
				                  <th>Gi·∫£m Gi√°</th>
				                  <th>Gi√° tr·ªã ƒë∆°n t·ªëi thi·ªÉu</th>
				                  <th>Gi·∫£m t·ªëi ƒëa</th>
				                  <th>L∆∞·ª£t s·ª≠ d·ª•ng</th>
				                  <th>T·ªëi ƒëa s·ª≠ d·ª•ng</th>
				                  <th>T·ªëi ƒëa m·ªói ng∆∞·ªùi</th>
				                  <th>Ng√†y b·∫Øt ƒë·∫ßu</th>
				                  <th>Ng√†y k·∫øt th√∫c</th>
				                  <th>√Åp d·ª•ng</th>
				                  <th>ƒêi·ªÅu ki·ªán s·ª≠ d·ª•ng</th>
				                  <th>H√†nh ƒë·ªông</th>
				                  <th>L·ªãch s·ª≠</th>
								  <th>Ng∆∞·ªùi t·∫°o</th>
								  <th>Th·ªùi gian t·∫°o</th>
				              </tr>
				          </thead>
				          <tbody>
				              <tr th:each="voucher : ${ongoingVouchers}">
									<td class="d-none">
									    <span class="countdown-timer countdown-start" th:data-start="${voucher.startDate}"></span>
									</td>
									<td>
									    <span class="countdown-timer countdown-end" th:data-end="${voucher.endDate}"></span>
									</td>
				                  <td th:text="${voucher.code}"></td>
				                  <td>
				                      <span th:text="${voucher.discountAmount}"></span>
				                      <span th:if="${voucher.discountType == 'PERCENT'}">%</span>
				                      <span th:if="${voucher.discountType == 'AMOUNT'}">VNƒê</span>
				                  </td>
				                  <td th:text="${voucher.minOrderAmount}"></td>
				                  <td th:text="${voucher.maxDiscount}"></td>
				                  <td th:text="${voucher.usageCount}"></td>
				                  <td th:text="${voucher.maxUsage}"></td>
				                  <td th:text="${voucher.maxUsagePerUser}"></td>
				                  <td th:text="${voucher.startDate}"></td>
				                  <td th:text="${voucher.endDate}"></td>
				                  <td style="text-align: justify;">
				                      <span th:if="${voucher.applicableToAll}">T·∫•t c·∫£ m√≥n ƒÉn</span>
				                      <div th:if="${!voucher.applicableToAll}" class="border p-3 rounded bg-white">
				                          <div class="row">
				                              <div th:each="item : ${voucher.applicableItems}" class="col-md-12 col-sm-12 mb-2">
				                                  <div class="d-flex align-items-center">
				                                      <div class="flex-grow-1 ml-2">
				                                          <strong th:text="${item.name}"></strong>
				                                          <small class="text-muted d-block">
				                                              (Gi√°: <span th:text="${item.price}"></span> VND)
				                                          </small>
				                                      </div>
				                                      <img th:src="${item.imageUrl}" alt="H√¨nh ·∫£nh m√≥n ƒÉn" 
				                                           class="rounded" style="width: 50px; height: 50px; object-fit: cover;">
				                                  </div>
				                              </div>
				                          </div>
				                      </div>
				                  </td>
				                  <td style="text-align: justify;">
				                      <pre th:text="${voucher.usageCondition}"></pre>
				                  </td>
				                  <td>
				                      <a th:href="@{/admin/vouchers/edit/{code}(code=${voucher.code})}" class="btn btn-warning btn-sm">‚úè Ch·ªânh s·ª≠a</a>
				                      <a th:href="@{/admin/vouchers/delete/{code}(code=${voucher.code})}" class="btn btn-danger btn-sm"
				                         onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a voucher n√†y?')">üóë X√≥a</a>
				                  </td>
				                  <td>
				                      <a th:href="@{/admin/vouchers/history/{voucherCode}(voucherCode=${voucher.code})}" class="btn btn-info btn-sm">üìú Xem l·ªãch s·ª≠</a>
				                  </td>
								  <td th:text="${voucher.createdBy.username}"></td>
								  <td th:text="${voucher.createdAt != null ? #temporals.format(voucher.createdAt, 'dd/MM/yyyy HH:mm:ss') : 'Ch∆∞a c√≥ d·ªØ li·ªáu'}"></td>
								  <td>
									<form th:action="@{/user/vouchers/save/{voucherCode}(voucherCode=${voucher.code})}" method="post">
																		    <button type="submit" class="btn btn-success btn-sm">üíæ L∆∞u</button>
																		</form>
	  	  						  </td>
							   </tr>
				          </tbody>
                    </table>
                </div>
            </div>

            <!-- Voucher s·∫Øp di·ªÖn ra -->
            <div id="upcoming" class="tab-pane fade">
                <h3 class="text-center text-success">üü¢ Voucher s·∫Øp di·ªÖn ra</h3>
                <div class="table-responsive">
                    <table class="table table-bordered table-hover text-center">
						<thead>
				              <tr>
								  <th>Th·ªùi gian ƒë·∫øm ng∆∞·ª£c</th> <!-- C·ªôt ƒë·∫øm ng∆∞·ª£c -->
				                  <th>M√£ Voucher</th>
				                  <th>Gi·∫£m Gi√°</th>
				                  <th>Gi√° tr·ªã ƒë∆°n t·ªëi thi·ªÉu</th>
				                  <th>Gi·∫£m t·ªëi ƒëa</th>
				                  <th>L∆∞·ª£t s·ª≠ d·ª•ng</th>
				                  <th>T·ªëi ƒëa s·ª≠ d·ª•ng</th>
				                  <th>T·ªëi ƒëa m·ªói ng∆∞·ªùi</th>
				                  <th>Ng√†y b·∫Øt ƒë·∫ßu</th>
				                  <th>Ng√†y k·∫øt th√∫c</th>
				                  <th>√Åp d·ª•ng</th>
				                  <th>ƒêi·ªÅu ki·ªán s·ª≠ d·ª•ng</th>
				                  <th>H√†nh ƒë·ªông</th>
				                  <th>L·ªãch s·ª≠</th>
								  <th>Ng∆∞·ªùi t·∫°o</th>
								  <th>Th·ªùi gian t·∫°o</th>
								  <th>L∆∞u v√†o v√≠</th> <!-- Th√™m ti√™u ƒë·ªÅ c·ªôt -->
				              </tr>
				          </thead>
				          <tbody>
				              <tr th:each="voucher : ${upcomingVouchers}">
									<td>
									    <span class="countdown-timer countdown-start" th:data-start="${voucher.startDate}"></span>
									</td>
									<td class="d-none">
									    <span class="countdown-timer countdown-end" th:data-end="${voucher.endDate}"></span>
									</td>
				                  <td th:text="${voucher.code}"></td>
				                  <td>
				                      <span th:text="${voucher.discountAmount}"></span>
				                      <span th:if="${voucher.discountType == 'PERCENT'}">%</span>
				                      <span th:if="${voucher.discountType == 'AMOUNT'}">VNƒê</span>
				                  </td>
				                  <td th:text="${voucher.minOrderAmount}"></td>
				                  <td th:text="${voucher.maxDiscount}"></td>
				                  <td th:text="${voucher.usageCount}"></td>
				                  <td th:text="${voucher.maxUsage}"></td>
				                  <td th:text="${voucher.maxUsagePerUser}"></td>
				                  <td th:text="${voucher.startDate}"></td>
				                  <td th:text="${voucher.endDate}"></td>
				                  <td style="text-align: justify;">
				                      <span th:if="${voucher.applicableToAll}">T·∫•t c·∫£ m√≥n ƒÉn</span>
				                      <div th:if="${!voucher.applicableToAll}" class="border p-3 rounded bg-white">
				                          <div class="row">
				                              <div th:each="item : ${voucher.applicableItems}" class="col-md-12 col-sm-12 mb-2">
				                                  <div class="d-flex align-items-center">
				                                      <div class="flex-grow-1 ml-2">
				                                          <strong th:text="${item.name}"></strong>
				                                          <small class="text-muted d-block">
				                                              (Gi√°: <span th:text="${item.price}"></span> VND)
				                                          </small>
				                                      </div>
				                                      <img th:src="${item.imageUrl}" alt="H√¨nh ·∫£nh m√≥n ƒÉn" 
				                                           class="rounded" style="width: 50px; height: 50px; object-fit: cover;">
				                                  </div>
				                              </div>
				                          </div>
				                      </div>
				                  </td>
				                  <td style="text-align: justify;">
				                      <pre th:text="${voucher.usageCondition}"></pre>
				                  </td>
				                  <td>
				                      <a th:href="@{/admin/vouchers/edit/{code}(code=${voucher.code})}" class="btn btn-warning btn-sm">‚úè Ch·ªânh s·ª≠a</a>
				                      <a th:href="@{/admin/vouchers/delete/{code}(code=${voucher.code})}" class="btn btn-danger btn-sm"
				                         onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a voucher n√†y?')">üóë X√≥a</a>
				                  </td>
				                  <td>
				                      <a th:href="@{/admin/vouchers/history/{voucherCode}(voucherCode=${voucher.code})}" class="btn btn-info btn-sm">üìú Xem l·ªãch s·ª≠</a>
				                  </td>
								  <td th:text="${voucher.createdBy.username}"></td>
								  <td th:text="${voucher.createdAt != null ? #temporals.format(voucher.createdAt, 'dd/MM/yyyy HH:mm:ss') : 'Ch∆∞a c√≥ d·ªØ li·ªáu'}"></td>
								  <td>
									<form th:action="@{/user/vouchers/save/{voucherCode}(voucherCode=${voucher.code})}" method="post">
									    <button type="submit" class="btn btn-success btn-sm">üíæ L∆∞u</button>
									</form>
		  						  </td>
							  </tr>
							
				          </tbody>
                    </table>
					<div th:if="${#lists.isEmpty(upcomingVouchers)}" class="alert alert-info text-center">Kh√¥ng c√≥ voucher s·∫Øp di·ªÖn ra.</div>
                </div>
            </div>
            <!-- Voucher ƒë√£ h·∫øt h·∫°n -->
            <div id="expired" class="tab-pane fade">
                <h3 class="text-center text-danger">üî¥ Voucher ƒë√£ h·∫øt h·∫°n</h3>
                <div class="table-responsive">
                    <table class="table table-bordered table-hover text-center">
						<thead>
				              <tr>
							      <th>Th·ªùi gian di·ªÖn ra</th>
				                  <th>M√£ Voucher</th>
				                  <th>Gi·∫£m Gi√°</th>
				                  <th>Gi√° tr·ªã ƒë∆°n t·ªëi thi·ªÉu</th>
				                  <th>Gi·∫£m t·ªëi ƒëa</th>
				                  <th>L∆∞·ª£t s·ª≠ d·ª•ng</th>
				                  <th>T·ªëi ƒëa s·ª≠ d·ª•ng</th>
				                  <th>T·ªëi ƒëa m·ªói ng∆∞·ªùi</th>
				                  <th>Ng√†y b·∫Øt ƒë·∫ßu</th>
				                  <th>Ng√†y k·∫øt th√∫c</th>
				                  <th>√Åp d·ª•ng</th>
				                  <th>ƒêi·ªÅu ki·ªán s·ª≠ d·ª•ng</th>
				                  <th>H√†nh ƒë·ªông</th>
				                  <th>L·ªãch s·ª≠</th>
				              </tr>
				          </thead>
				          <tbody>
				              <tr th:each="voucher : ${expiredVouchers}">
								<td class="d-none">
								    <span class="countdown-timer countdown-start" th:data-start="${voucher.startDate}"></span>
								</td>
								<td>
								    <span class="countdown-timer countdown-end" th:data-end="${voucher.endDate}"></span>
								</td>
				                  <td th:text="${voucher.code}"></td>
				                  <td>
				                      <span th:text="${voucher.discountAmount}"></span>
				                      <span th:if="${voucher.discountType == 'PERCENT'}">%</span>
				                      <span th:if="${voucher.discountType == 'AMOUNT'}">VNƒê</span>
				                  </td>
				                  <td th:text="${voucher.minOrderAmount}"></td>
				                  <td th:text="${voucher.maxDiscount}"></td>
				                  <td th:text="${voucher.usageCount}"></td>
				                  <td th:text="${voucher.maxUsage}"></td>
				                  <td th:text="${voucher.maxUsagePerUser}"></td>
				                  <td th:text="${voucher.startDate}"></td>
				                  <td th:text="${voucher.endDate}"></td>
				                  <td style="text-align: justify;">
				                      <span th:if="${voucher.applicableToAll}">T·∫•t c·∫£ m√≥n ƒÉn</span>
				                      <div th:if="${!voucher.applicableToAll}" class="border p-3 rounded bg-white">
				                          <div class="row">
				                              <div th:each="item : ${voucher.applicableItems}" class="col-md-12 col-sm-12 mb-2">
				                                  <div class="d-flex align-items-center">
				                                      <div class="flex-grow-1 ml-2">
				                                          <strong th:text="${item.name}"></strong>
				                                          <small class="text-muted d-block">
				                                              (Gi√°: <span th:text="${item.price}"></span> VND)
				                                          </small>
				                                      </div>
				                                      <img th:src="${item.imageUrl}" alt="H√¨nh ·∫£nh m√≥n ƒÉn" 
				                                           class="rounded" style="width: 50px; height: 50px; object-fit: cover;">
				                                  </div>
				                              </div>
				                          </div>
				                      </div>
				                  </td>
				                  <td style="text-align: justify;">
				                      <pre th:text="${voucher.usageCondition}"></pre>
				                  </td>
				                  <td>
				                      <a th:href="@{/admin/vouchers/edit/{code}(code=${voucher.code})}" class="btn btn-warning btn-sm">‚úè Ch·ªânh s·ª≠a</a>
				                      <a th:href="@{/admin/vouchers/delete/{code}(code=${voucher.code})}" class="btn btn-danger btn-sm"
				                         onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a voucher n√†y?')">üóë X√≥a</a>
				                  </td>
				                  <td>
				                      <a th:href="@{/admin/vouchers/history/{voucherCode}(voucherCode=${voucher.code})}" class="btn btn-info btn-sm">üìú Xem l·ªãch s·ª≠</a>
				                  </td>
				              </tr>
				          </tbody>
                    </table>
					<div th:if="${#lists.isEmpty(expiredVouchers)}" class="alert alert-info text-center">Kh√¥ng c√≥ voucher ƒë√£ h·∫øt h·∫°n.</div>

                </div>
            </div>
        </div>
    </div>
	<script>
	document.addEventListener("DOMContentLoaded", function () {
	    let tabs = document.querySelectorAll("#voucherTabs .nav-link");

	    // L·∫•y tab ƒëang l∆∞u trong LocalStorage, n·∫øu kh√¥ng c√≥ th√¨ m·∫∑c ƒë·ªãnh l√† '#ongoing'
	    let activeTab = localStorage.getItem("activeVoucherTab") || "#ongoing";

	    // X√≥a l·ªõp 'active' kh·ªèi t·∫•t c·∫£ tab v√† n·ªôi dung tab
	    tabs.forEach(tab => tab.classList.remove("active"));
	    document.querySelectorAll(".tab-pane").forEach(pane => pane.classList.remove("show", "active"));

	    // K√≠ch ho·∫°t tab ƒë√£ l∆∞u trong LocalStorage
	    let activeTabElement = document.querySelector(`a[href="${activeTab}"]`);
	    if (activeTabElement) {
	        activeTabElement.classList.add("active");
	        document.querySelector(activeTab).classList.add("show", "active");
	    }

	    // L·∫Øng nghe s·ª± ki·ªán chuy·ªÉn tab v√† l∆∞u v√†o LocalStorage
	    tabs.forEach(tab => {
	        tab.addEventListener("click", function (event) {
	            event.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh
	            let selectedTab = this.getAttribute("href");

	            // L∆∞u tab v√†o LocalStorage
	            localStorage.setItem("activeVoucherTab", selectedTab);

	            // C·∫≠p nh·∫≠t hi·ªÉn th·ªã tab
	            tabs.forEach(t => t.classList.remove("active"));
	            document.querySelectorAll(".tab-pane").forEach(pane => pane.classList.remove("show", "active"));

	            this.classList.add("active");
	            document.querySelector(selectedTab).classList.add("show", "active");
	        });
	    });
	});
	
	function countdownTimer(element, targetTime) {
	      function updateTimer() {
	          let now = new Date().getTime();
	          let timeDiff = targetTime - now;

	          if (timeDiff <= 0) {
	              element.innerText = "ƒê√£ h·∫øt h·∫°n";
	              element.style.background = "#777"; // M√†u x√°m khi h·∫øt h·∫°n
	              return;
	          }

	          let days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
	          let hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
	          let minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
	          let seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);

	          element.innerText = `${days}d ${hours}h ${minutes}m ${seconds}s`;
	      }

	      updateTimer();
	      let interval = setInterval(updateTimer, 1000);

	      setTimeout(() => clearInterval(interval), targetTime - new Date().getTime());
	  }

	  document.addEventListener("DOMContentLoaded", function () {
	      document.querySelectorAll(".countdown-start").forEach(element => {
	          let startDateStr = element.getAttribute("data-start");
	          let startDate = new Date(startDateStr).getTime();
	          countdownTimer(element, startDate);
	      });

	      document.querySelectorAll(".countdown-end").forEach(element => {
	          let endDateStr = element.getAttribute("data-end");
	          let endDate = new Date(endDateStr).getTime();
	          countdownTimer(element, endDate);
	      });
	  });
	</script>


</body>
</html>
