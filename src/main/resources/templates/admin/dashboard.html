<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang chủ Admin</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
	<link rel="icon" href="https://gigamall.com.vn/data/2024/05/10/14290213_shushiwa.jpg" type="image/x-icon">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">	
	<!-- Link đến Bootstrap CSS từ CDN -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
	<!-- Custom CSS -->
	<!-- Thêm Font Awesome CDN -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
			font-family: 'Poppins', sans-serif;
			background-color: #fdf5f3;
            margin: 0;
            padding: 0;
            display: flex;
        }
	
		.stat-title {
		  position: relative; /* Để định vị vị trí tuyệt đối của icon bên trong */
		}

		.icon-container {
		  position: absolute; /* Định vị biểu tượng tuyệt đối */
		  bottom: 20px; /* Khoảng cách từ dưới cùng */
		  right: 20px;  /* Khoảng cách từ bên phải */
		}

		.circle-icon {
		  display: inline-block;
		
		}
		.sidebar-dropdown {
		    display: none;
		    list-style: none;
		    padding-left: 20px;
		}

		.sidebar-dropdown li {
		    padding: 5px 0;
		}

		.sidebar-dropdown a {
		    text-decoration: none;
		    color: #fff;
		    display: flex;
		    align-items: center;
		}

		.sidebar-dropdown a i {
		    margin-right: 8px;
		}

		.sidebar-item.active .sidebar-dropdown {
		    display: block; /* Hiện menu con khi có class active */
		}

		.dropdown-icon {
		    margin-left: auto;
		    transition: transform 0.3s;
		}

		.sidebar-item.active .dropdown-icon {
		    transform: rotate(180deg);
		}
		.sidebar-item a {
		    display: flex;  /* Đặt các phần tử con theo chiều ngang */
		    align-items: center;  /* Căn giữa theo chiều dọc */
		}

		.sidebar {
		    width: 70px; /* Kích thước sidebar khi không rê chuột */
		    background-color: #333;
			position: fixed; /* Cố định sidebar */
		    top: 0px; /* Đặt sidebar ở trên cùng */
		    left: 0; /* Đặt sidebar ở bên trái */
		    padding: 15px;
		    transition: width 0.3s;
			position: fixed; /* Cố định sidebar */
			height: 100%;
			z-index: 1000; /* Đảm bảo sidebar ở trên cùng */
			font-size: 13px;
		}
		.sidebar h2 {
		    color: white;
		    text-align: center;
		    font-size: 20px;
		    margin-bottom: 20px;
		}

		/* Kiểu dáng các mục trong sidebar */
		.sidebar ul {
		    list-style-type: none;
		    padding: 0;
		}

		.sidebar-item {
		    margin: 15px 0;
		}

		.sidebar-item a {
		    color: white;
		    text-decoration: none;
		    display: flex;
		    align-items: center;
		    transition: padding 0.3s;
		}

		.sidebar-item i {
		    font-size: 24px;
		}

		/* Ẩn tên mục trong sidebar */
		.sidebar-text {
		    display: none; /* Ẩn tên mục */
		    margin-left: 10px;
		    font-size: 14px;
		}

		/* Khi rê chuột vào sidebar, mở rộng và hiển thị tên mục */
		.sidebar:hover {
		    width: 250px; /* Kích thước sidebar khi rê chuột vào */
		}

		.sidebar:hover .sidebar-text {
		    display: inline; /* Hiển thị tên mục khi rê chuột */
		}
		.stat-box {
		         border: 1px solid #ddd;
		         border-radius: 8px;
		         padding: 20px;
		         text-align: center;
		         margin-bottom: 20px;
		     }
		     .stat-title {
		         font-weight: bold;
		         margin-bottom: 10px;
		     }
		     .stat-value {
		         font-size: 1.5rem;
		         color: #007bff;
		     }

        .sidebar h2 {
            font-size: 24px;
            color: #f8f9fa;
            margin-bottom: 30px;
            text-align: center;
        }

        .sidebar ul {
            list-style-type: none;
            padding: 0;
        }

        .sidebar ul li {
            padding: 10px 15px;
            border-radius: 4px;
            margin-bottom: 5px;
            cursor: pointer;
        }

        .sidebar ul li:hover {
            background-color: #495057;
        }

        .sidebar a {
            text-decoration: none;
            color: white;
            display: block;
        }

		.main-content {
		    margin-left: 60px; /* Thay đổi để phù hợp với kích thước sidebar khi ẩn */
		    padding: 20px;
		    width: calc(100% - 60px); /* Cập nhật lại chiều rộng cho nội dung chính */
		    transition: margin-left 0.3s ease; /* Thêm hiệu ứng mượt mà khi sidebar thay đổi kích thước */
		}


        footer {
            background-color: #343a40;
            color: white;
            padding: 10px;
            text-align: center;
            position: fixed;
            width: 100%;
            bottom: 0;
        }

        .nav-tabs .nav-link.active {
            background-color: #343a40;
            color: white;
        }
		canvas {
		    max-height: 400px;
		}
		/* CSS để hiển thị nút hamburger và đặt nó ở góc trên bên trái */
		.toggle-sidebar {
		    display: none; /* Ẩn mặc định */
		    position: fixed;
		    top: 10px;
		    left: 10px;
		    background-color: transparent;
		    border: none;
		    font-size: 30px;
		    color: black;
		    z-index: 1000;
		}
		/* Lớp ẩn sidebar */
		.sidebar.hide {
		    display: none;
		}

		/* Lớp hiển thị sidebar */
		.sidebar.show {
		    display: block;
		}

		/* Thêm vào cuối CSS */
		@media (max-width: 768px) {
		    /* Sidebar ẩn khi màn hình nhỏ */
		    .sidebar {
		        display: none;  /* Ẩn sidebar trên màn hình nhỏ */
		        position: absolute;
		        width: 100%;
		        height: auto;
		        padding: 10px;
		        background-color: #343a40;
		    }
			.toggle-sidebar {
			     display: block; /* Hiển thị nút khi màn hình nhỏ */
			 }

		    /* Mở rộng nội dung chính khi sidebar ẩn */
		    .main-content {
		        margin-left: 0;
		        padding: 10px;
		        width: 100%;
		    }

		    /* Điều chỉnh các tiêu đề và văn bản cho phù hợp */
		    .card-header h3, .card-body h2 {
		        font-size: 18px;
		    }

		    .nav-tabs .nav-link {
		        font-size: 14px;
		    }

		    /* Điều chỉnh biểu đồ cho phù hợp với chiều rộng */
		    canvas {
		        width: 100% !important;
		        max-width: 100% !important;
		    }

		    /* Điều chỉnh bảng */
		    .table-responsive {
		        margin-bottom: 20px;
		    }
		}

    </style>
</head>
<body>
	<!-- Nút để mở Sidebar trên màn hình nhỏ -->
	<!-- Nút để mở Sidebar trên màn hình nhỏ -->
	<button class="toggle-sidebar" id="toggleSidebar">
	    <i class="fas fa-bars"></i> <!-- Biểu tượng Menu -->
	</button>

	<!-- Sidebar -->
	<div class="sidebar">
	    <h2><span class="sidebar-text">Admin Panel</span></h2>
	    <ul>
	        <li class="nav-item" th:if="${session.loggedInUser != null}">
	            <a class="nav-link" href="#" id="userDropdown" role="button" aria-haspopup="true" aria-expanded="false">
	           		<span class="sidebar-text">  Xin chào,   [[${session.loggedInUser}]]! </span> <br> 
	            </a>
	        </li>
	        <li class="sidebar-item">
	            <a href="/index"><i class="fas fa-home"></i><span class="sidebar-text">Sushi Wa</span></a>
	        </li>
	        <li class="sidebar-item">
	            <a href="/admin"><i class="fas fa-tachometer-alt"></i><span class="sidebar-text">Dashboard</span></a>
	        </li>
	        <li class="sidebar-item">
	            <a href="/admin/products"><i class="fas fa-box"></i><span class="sidebar-text">Products</span></a>
	        </li>
	        <li class="sidebar-item">
	            <a href="/admin/orders"><i class="fas fa-shopping-cart"></i><span class="sidebar-text">Orders</span></a>
	        </li>
	        <li class="sidebar-item">
	            <a href="/admin/customers"><i class="fas fa-users"></i><span class="sidebar-text">Customers</span></a>
	        </li>
			<li class="sidebar-item">
			    <a href="#" onclick="toggleDropdown(event, 'promotions-dropdown')">
			        <i class="fas fa-tags"></i>
			        <span class="sidebar-text">Promotions <i class="fas fa-chevron-down dropdown-icon"></i></span>
			    <ul class="sidebar-dropdown" id="promotions-dropdown">
			        <li><a href="/admin/vouchers"><i class="fas fa-ticket-alt"></i> Voucher</a></li>
					<li><a href="/admin/vouchers/create"><i class="fas fa-ticket-alt"></i>Tạo Voucher</a></li>
			        <li><a href="/admin/promotions"><i class="fas fa-newspaper"></i> Bài Viết</a></li>					
			    </ul>
				
			</li>
	        <li class="sidebar-item">
	            <a href="/logout"><i class="fas fa-sign-out-alt"></i><span class="sidebar-text">Logout</span></a>
	        </li>
	    </ul>
	</div>
		<div class="main-content">
		<div class="container-fluid">
			<h1 class="mb-4">Trang chủ Admin</h1>
		
			<form class="form-inline mb-4" method="get" action="/admin/dashboard">
				<label for="view" class="mr-2">Xem:</label>
				    <select class="form-control mr-3" name="view" id="view" onchange="this.form.submit()">
				        <option value="day">Hôm nay</option>
				        <option value="yesterday">Hôm qua</option>
				        <option value="week">Tuần này</option>
				        <option value="month">Tháng này</option>
				        <option value="lastm">Tháng trước</option>
				        <option value="year">Năm nay</option>
				        <option value="lasty">Năm trước</option>
				        <option value="all">Toàn thời gian</option>
				    </select>
			        <label for="specificDate" class="mr-2">Ngày cụ thể:</label>
			        <input type="date" class="form-control mr-3" name="specificDate" value="${specificDate}">
					<label for="startDateTime" class="mr-2">Từ ngày giờ:</label>
					<input type="datetime-local" class="form-control mr-3" name="startDateTime" th:value="${startDateTime}">

					<label for="endDateTime" class="mr-2">Đến ngày giờ:</label>
					<input type="datetime-local" class="form-control mr-3" name="endDateTime" th:value="${endDateTime}">
			        <button type="submit" class="btn btn-primary">Đồng ý</button>
			    </form>
				<p th:text="${timeRangeMessage}" style="font-weight: bold; color: #ff5733;"></p>

			    <div class="row">
			        <div class="col-md-3">
			            <div class="stat-box">
			                <div class="stat-title">Tiền hàng</div>
			                <div class="stat-value">
								<span th:text="${totalRevenueItem}">0</span> đ
							</div>
			            </div>
			        </div>
					<div class="col-md-3">
			            <div class="stat-box">
			                <div class="stat-title">Hoàn hủy</div>
							<a class="nav-link" href="/admin/orders?statusFilter=CANCELED">
			                	<div class="stat-value"> <span th:text="${totalCanceledRevenue}"></span> đ</div>
							</a>
			            </div>
			        </div>
			      
					<div class="col-md-3">
					    <div class="stat-box">
					        <div class="stat-title">
					            Giảm giá
					            <!-- Biểu tượng "!" để mở modal -->
					           
					        </div>
					        <div class="stat-value">
					            <!-- Hiển thị tổng giảm giá -->
					            <span th:text="${totalDiscount}">10000</span> đ
					        </div>
							<span style="cursor:pointer;" data-bs-toggle="modal" data-bs-target="#detailsModal" class="icon-container">
								<i class="fa fa-exclamation-circle circle-icon"></i>
				            </span>
					    </div>
					</div>
			        <div class="col-md-3">
			            <div class="stat-box">
			                <div class="stat-title">Doanh thu thực tế</div>
			                <div class="stat-value"><span th:text="${totalRevenue}">10000</span> đ</div>
							<span style="cursor:pointer;" data-bs-toggle="modal" data-bs-target="#detailsModal2" class="icon-container">
								<i class="fa fa-exclamation-circle circle-icon"></i>
				            </span>
			            </div>
			        </div>
					
			        <div class="col-md-4">
			            <div class="stat-box">
			                <div class="stat-title">Số hóa đơn</div>
			                <div class="stat-value"> <span th:text="${totalSales}">500</span></div>
			            </div>
			        </div>
			        <div class="col-md-4">
			            <div class="stat-box">
			                <div class="stat-title">TB mặt hàng/hóa đơn</div>
			                <div class="stat-value">
								<span th:text="${totalSales != 0 ? totalQuantity * 1.0 / totalSales : 'N/A'}">N/A</span>
							</div>
			            </div>
			        </div>
			        <div class="col-md-4">
			            <div class="stat-box">
			                <div class="stat-title">TB doanh thu/hóa đơn</div>
			                <div class="stat-value">
								<span th:text="${formattedAverageRevenuePerSale}">0</span>đ	
							 </div>
			            </div>
			        </div>
					<div class="col-md-12">
					    <div class="stat-box">
					        <div class="stat-title">Doanh thu đang chờ xử lý</div>
					        <div class="stat-value">
					            <h2 class="mt-4">
					                <span th:text="${projectedRevenue}">10000</span> đ
					            </h2>
					        </div>
					        <div class="stat-value">
					            <h5>
					                <a class="nav-link" href="/admin/orders?statusFilter=PENDING">Xem đơn hàng đang chờ xử lý</a>
					            </h5>
					        </div>
					    </div>
					</div>
			    </div>
				</div>
        <div class="container-fluid">
            <!-- Tab Navigation -->
			<ul class="nav nav-tabs">
			    <li class="nav-item">
			        <a class="nav-link active" data-toggle="tab" href="#orders">Đơn hàng</a>
			    </li>
			    <li class="nav-item">
			        <a class="nav-link" data-toggle="tab" href="#canceled-orders">Đơn hàng bị hủy</a>
			    </li>
			    <li class="nav-item">
			        <a class="nav-link" data-toggle="tab" href="#payment-methods">Doanh thu theo PTTT</a>
			    </li>
			</ul>			
			<div class="tab-content">
			    <!-- Orders Tab -->
			    <div class="tab-pane container active" id="orders">
			        <h2>Số đơn hàng: <span th:text="${totalSales}">500</span></h2>
			        <div class="table-responsive">
			            <table class="table table-striped table-bordered">
			                <thead class="thead-dark">
			                    <tr>
			                        <th>Tên món ăn</th>
			                        <th>Số lượng bán</th>
			                        <th>Doanh thu</th>
			                    </tr>
			                </thead>
			                <tbody>
			                    <tr th:each="item : ${menuItemSales}">
			                        <td th:text="${item[0]}">Sushi A</td>
			                        <td th:text="${item[1]}">10</td>
			                        <td th:text="${item[3]}">1000</td>
			                    </tr>
			                    <tr class="font-weight-bold">
			                        <td>Tổng</td>
			                        <td th:text="${totalQuantity}">0</td>
			                        <td th:text="${totalRevenueItem}">0</td>
			                    </tr>
			                </tbody>
			            </table>
			        </div>
			        <h2 class="mt-4">Tổng doanh thu: <span th:text="${totalRevenue}">10000</span></h2>
					<div class="row mt-5"> 
						<div class="col-md-12">
							<div class="chart-container">
							    <h3>Doanh thu theo giờ trong 7 ngày qua</h3>
							    <canvas id="revenueChart"></canvas>
							</div>
						</div>
					</div>
			        <div class="row mt-5">
			            <!-- Biểu đồ Số lượng bán -->
			            <div class="col-md-12">
			                <h5 class="text-center">Biểu đồ Số lượng bán</h5>
			                <canvas id="salesChart"></canvas>
			            </div>

			            <!-- Biểu đồ tròn - Phân bố Doanh thu -->
			            <div class="col-md-12">
			                <h5 class="text-center">Biểu đồ tròn - Phân bố Doanh thu</h5>
			                <canvas id="revenuePieChart"></canvas>
			            </div>
			        </div>

			        <div class="row mt-4">
			            <!-- Biểu đồ Xu hướng doanh thu -->
			            <div class="col-md-6">
			                <h5 class="text-center">Xu hướng Doanh thu</h5>
			                <canvas id="revenueLineChart"></canvas>
			            </div>

			            <!-- Biểu đồ Danh sách món bán chạy -->
			            <div class="col-md-6">
			                <h5 class="text-center">Danh sách món bán chạy</h5>
			                <canvas id="horizontalBarChart"></canvas>
			            </div>
			        </div>
			    </div>

			    <!-- Payment Methods Revenue Tab -->
				<div class="tab-pane container fade" id="payment-methods">
				    <h3>Doanh thu theo phương thức thanh toán</h3>

				    <!-- Kiểm tra nếu có dữ liệu doanh thu -->
				    <div th:if="${totalRevenueByPaymentMethod != '0' and totalRevenueByPaymentMethod != '0.00'}">
				        <canvas id="paymentMethodChart" style="width:100%; height:400px;"></canvas>
				        <h4 class="text-end">Tổng doanh thu: <span th:text="${totalRevenueByPaymentMethod}"></span> VNĐ</h4>
				    </div>

				    <!-- Hiển thị nếu không có dữ liệu -->
				    <div th:if="${totalRevenueByPaymentMethod == '0' or totalRevenueByPaymentMethod == '0.00'}" class="text-center">
				        <h4 class="text-muted"> <i>Chưa có dữ liệu doanh thu </i> </h4>
				    </div>
				</div>

			    <!-- Canceled Orders Tab -->
			    <div class="tab-pane container fade" id="canceled-orders">
			        <h3>Đơn hàng đã hủy: <span th:text="${totalCanceledSales}">0</span></h3>
			        <div class="table-responsive">
			            <table class="table table-striped table-bordered">
			                <thead class="thead-dark">
			                    <tr>
			                        <th>Tên món ăn</th>
			                        <th>Số lượng</th>
			                        <th>Doanh thu</th>
			                    </tr>
			                </thead>
			                <tbody>
			                    <tr th:each="item : ${canceledMenuItemSales}">
			                        <td th:text="${item[0]}">Sushi A</td>
			                        <td th:text="${item[1]}">10</td>
			                        <td th:text="${#numbers.formatInteger(item[2], 0, 'POINT')}">1000</td>

			                    </tr>
			                    <tr class="font-weight-bold">
			                        <td>Tổng</td>
			                        <td th:text="${totalCanceledQuantity}">0</td>
			                        <td th:text="${totalCanceledRevenueItem}">0</td>
			                    </tr>
			                </tbody>
			            </table>
			        </div>
			        <h2>Tổng tiền đã hủy: <span th:text="${totalCanceledRevenue}"></span></h2>
					<div class="stat-value">
					    <h5>
					        <a class="nav-link" href="/admin/orders?statusFilter=CANCELED">Xem đơn hàng đã hủy</a>
					    </h5>
					</div>
			    </div>
			</div>

	<!-- Modal chi tiết giảm giá -->
	<div class="modal fade" id="detailsModal" tabindex="-1" aria-labelledby="detailsModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title" id="detailsModalLabel">Chi tiết giảm giá</h5>
	        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	      </div>
	      <div class="modal-body">
			<table class="table">
			    <thead>
			        <tr>
			            <th>Loại Giảm Giá</th>
			            <th>Số Tiền</th>
			        </tr>
			    </thead>
			    <tbody>
					<tr>
					    <td>Giảm giá từ Voucher</td>
					    <td><span th:text="${totalVoucherDiscountUsed}">10000</span> đ</td>
					</tr>
					<tr>
					    <td colspan="2">
					        <button class="btn" type="button" data-bs-toggle="collapse" data-bs-target="#voucherDetails" aria-expanded="false" aria-controls="voucherDetails" onclick="toggleArrow(this)">
					           Chi tiết <i class="fas fa-chevron-down"></i>
					        </button>
					        <div class="collapse mt-2" id="voucherDetails">
								<ul class="list-group small">
								    <li class="list-group-item py-1 px-2" th:each="entry : ${voucherDiscounts.entrySet()}">
								        <a th:href="@{'/admin/vouchers/history/' + ${entry.key}}" class="text-decoration-none">
								            <span th:text="${entry.key}"></span> - Giảm: 
								            <span th:text="${#numbers.formatInteger(entry.value, 0, 'POINT')}"></span> đ
								        </a>
								    </li>
								</ul>
								<p class="text-muted small" th:if="${#maps.isEmpty(voucherDiscounts)}">Chưa có dữ liệu để hiển thị</p>
					        </div>
					    </td>
					</tr>
			        <tr>
			            <td>Điểm sử dụng</td>
			            <td><span th:text="${totalPointsUsed}">10000</span> đ</td>
			        </tr>
					<tr>
			            <td colspan="2">
			              <button class="btn" type="button" data-bs-toggle="collapse" data-bs-target="#pointsDetails"
			                aria-expanded="false" aria-controls="pointsDetails" onclick="toggleArrow(this)">
			                Chi tiết <i class="fas fa-chevron-down"></i>
			              </button>
			              <div class="collapse mt-2" id="pointsDetails">
			                <ul class="list-group small">
			                  <li class="list-group-item py-1 px-2" th:each="entry : ${pointsUsedMap.entrySet()}">
								<a  title="Xem chi tiết" th:href="@{'/admin/customers/details/' + ${userTokens[entry.key]}}" class="text-decoration-none">
								    <span th:text="${entry.key}"></span> - Đã sử dụng:
								    <span th:text="${#numbers.formatInteger(entry.value, 0, 'POINT')}"></span> điểm
								    ~ <span th:text="${#numbers.formatInteger(entry.value * 500, 0, 'POINT')}"></span>đ
								</a>

			                  </li>
			                </ul>
			                <p class="text-muted small" th:if="${#maps.isEmpty(pointsUsedMap)}">Chưa có dữ liệu để hiển thị</p>
			              </div>
			            </td>
			        </tr>
			        <tr>
			            <td><strong>Tổng cộng</strong></td>
			            <td><strong><span th:text="${totalDiscount}">20000</span> đ</strong></td>
			        </tr>
			    </tbody>
			</table>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
	      </div>
	    </div>
	  </div>
	</div>
	<!-- Modal của Chi tiết doanh thu -->
	<div class="modal fade" id="detailsModal2" tabindex="-1" aria-labelledby="detailsModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title" id="detailsModalLabel">Chi tiết doanh thu</h5>
	        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	      </div>
	      <div class="modal-body">
			<table class="table">
			    <thead>
			        <tr>
			            <th>Loại doanh thu</th>
			            <th>Số Tiền</th>
			        </tr>
			    </thead>
			    <tbody>
					<tr>
			            <td>Tiền hàng</td>
			            <td><span th:text="${totalRevenueItem}">10000</span> đ</td>
			        </tr>
					<tr>
					    <td>Giảm giá từ Voucher</td>
					    <td>- <span th:text="${totalVoucherDiscountUsed}">10000</span> đ</td>
					</tr>
					<tr>
					    <td colspan="2">
					        <button class="btn" type="button" data-bs-toggle="collapse" data-bs-target="#voucherDetails" aria-expanded="false" aria-controls="voucherDetails" onclick="toggleArrow(this)">
					           Chi tiết <i class="fas fa-chevron-down"></i>
					        </button>
					        <div class="collapse mt-2" id="voucherDetails">
								<ul class="list-group small">
								    <li class="list-group-item py-1 px-2" th:each="entry : ${voucherDiscounts.entrySet()}">
								        <a th:href="@{'/admin/vouchers/history/' + ${entry.key}}" class="text-decoration-none">
								            <span th:text="${entry.key}"></span> -Tổng giảm: 
								            <span th:text="${#numbers.formatInteger(entry.value, 0, 'POINT')}"></span> đ
								        </a>
								    </li>
								</ul>
								<p class="text-muted small" th:if="${#maps.isEmpty(voucherDiscounts)}">Chưa có dữ liệu để hiển thị</p>
					        </div>
					    </td>
					</tr>

					<script>
					    function toggleArrow(button) {
					        let icon = button.querySelector("i");
					        icon.classList.toggle("fa-chevron-down");
					        icon.classList.toggle("fa-chevron-up");
					    }
					</script>
			        <tr>
			            <td>Điểm sử dụng</td>
			            <td>- <span th:text="${totalPointsUsed}">10000</span> đ</td>
			        </tr>
					<tr>
			            <td colspan="2">
			              <button class="btn" type="button" data-bs-toggle="collapse" data-bs-target="#pointsDetails"
			                aria-expanded="false" aria-controls="pointsDetails" onclick="toggleArrow(this)">
			                Chi tiết <i class="fas fa-chevron-down"></i>
			              </button>
			              <div class="collapse mt-2" id="pointsDetails">
			                <ul class="list-group small">
			                  <li class="list-group-item py-1 px-2" th:each="entry : ${pointsUsedMap.entrySet()}">
								<a  title="Xem chi tiết" th:href="@{'/admin/customers/details/' + ${userTokens[entry.key]}}" class="text-decoration-none">
								    <span th:text="${entry.key}"></span> - Đã sử dụng:
								    <span th:text="${#numbers.formatInteger(entry.value, 0, 'POINT')}"></span> điểm
								    ~ <span th:text="${#numbers.formatInteger(entry.value * 500, 0, 'POINT')}"></span>đ
								</a>

			                  </li>
			                </ul>
			                <p class="text-muted small" th:if="${#maps.isEmpty(pointsUsedMap)}">Chưa có dữ liệu để hiển thị</p>
			              </div>
			            </td>
			        </tr>
			        <tr>
			            <td><strong>Tổng cộng</strong></td>
			            <td><strong><span th:text="${totalRevenue}">20000</span> đ</strong></td>
			        </tr>
			    </tbody>
			</table>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
	      </div>
	    </div>
	  </div>
	</div>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script th:inline="javascript">
		// Lấy các phần tử
		const toggleSidebarButton = document.getElementById('toggleSidebar');
		const sidebar = document.querySelector('.sidebar');

	// Lấy dữ liệu từ Thymeleaf
	   const days = /*[[${days}]]*/ [];
	   const dailyHourlyRevenues = /*[[${dailyHourlyRevenues}]]*/ [];
	   
		// Khi người dùng nhấn vào nút hamburger
		toggleSidebarButton.addEventListener('click', function() {
		    sidebar.classList.toggle('show'); // Toggle lớp 'show' để hiển thị sidebar
		    sidebar.classList.toggle('hide'); // Toggle lớp 'hide' để ẩn sidebar
		});

	    // Dữ liệu từ Thymeleaf
	    const itemNames = /*[[${itemNames}]]*/[];
	    const itemQuantities = /*[[${itemQuantities}]]*/[];
	    const itemRevenues = /*[[${itemRevenues}]]*/[];
		// Dữ liệu từ Thymeleaf
		// Lấy dữ liệu từ Thymeleaf
		
		const paymentMethods = /*[[${revenueByPaymentMethod.keySet()}]]*/ [];
		const paymentRevenues = /*[[${revenueByPaymentMethod.values()}]]*/ [];
	    // Biểu đồ Số lượng bán
		const ctx = document.getElementById('salesChart').getContext('2d');
		const salesChart = new Chart(ctx, {
		    type: 'bar',
		    data: {
		        labels: itemNames, // Tên món ăn
		        datasets: [
		            {
		                label: 'Số lượng bán',
		                data: itemQuantities,
		                backgroundColor: 'rgba(54, 162, 235, 0.2)',
		                borderColor: 'rgba(54, 162, 235, 1)',
		                borderWidth: 1,
		                yAxisID: 'y1' // Gắn với trục y1
		            },
		            {
		                label: 'Doanh thu',
		                data: itemRevenues.map(revenue => revenue), // Chuyển doanh thu thành nghìn đồng
		                backgroundColor: 'rgba(255, 99, 132, 0.2)',
		                borderColor: 'rgba(255, 99, 132, 1)',
		                borderWidth: 1,
		                type: 'line', // Hiển thị dưới dạng line
		                yAxisID: 'y2' // Gắn với trục y2
		            }
		        ]
		    },
		    options: {
		        responsive: true,
		        scales: {
		            y1: {
		                type: 'linear',
		                position: 'left', // Trục y1 bên trái
		                beginAtZero: true,
		                title: {
		                    display: true,
		                    text: 'Số lượng món bán ra'
		                }
		            },
		            y2: {
		                type: 'linear',
		                position: 'right', // Trục y2 bên phải
		                beginAtZero: true,
		                title: {
		                    display: true,
		                    text: 'Doanh thu '
		                },
		                grid: {
		                    drawOnChartArea: false // Không hiển thị lưới trục y2 để tránh bị rối
		                }
		            }
		        },
		        plugins: {
		            tooltip: {
		                enabled: true
		            }
		        }
		    }
		});
		
		    // Tạo biểu đồ tròn
		    const pieCtx = document.getElementById('revenuePieChart').getContext('2d');
		    const revenuePieChart = new Chart(pieCtx, {
		        type: 'pie',
		        data: {
		            labels: itemNames, // Tên món ăn
		            datasets: [{
		                label: 'Doanh thu',
		                data: itemRevenues, // Doanh thu từng món
		                backgroundColor: [
		                    'rgba(255, 99, 132, 0.2)',
		                    'rgba(54, 162, 235, 0.2)',
		                    'rgba(255, 206, 86, 0.2)',
		                    'rgba(75, 192, 192, 0.2)',
		                    'rgba(153, 102, 255, 0.2)',
		                    'rgba(255, 159, 64, 0.2)'
		                ],
		                borderColor: [
		                    'rgba(255, 99, 132, 1)',
		                    'rgba(54, 162, 235, 1)',
		                    'rgba(255, 206, 86, 1)',
		                    'rgba(75, 192, 192, 1)',
		                    'rgba(153, 102, 255, 1)',
		                    'rgba(255, 159, 64, 1)'
		                ],
		                borderWidth: 1
		            }]
		        },
		        options: {
		            responsive: true,
		            plugins: {
		                legend: {
		                    display: true,
		                    position: 'top'
		                },
		                tooltip: {
		                    enabled: true
		                }
		            }
		        }
		    });

			// Biểu đồ Danh sách món bán chạy
			const horizontalCtx = document.getElementById('horizontalBarChart').getContext('2d');
			new Chart(horizontalCtx, {
			    type: 'bar',
			    data: {
			        labels: itemNames,
			        datasets: [
			            {
			                label: 'Số lượng bán',
			                data: itemQuantities,
			                backgroundColor: 'rgba(75, 192, 192, 0.6)',
			                borderColor: 'rgba(75, 192, 192, 1)',
			                borderWidth: 1
			            }
			        ]
			    },
			    options: {
			        responsive: true,
			        maintainAspectRatio: false,
			        indexAxis: 'y', // Biểu đồ ngang
			        scales: {
			            x: {
			                beginAtZero: true,
			                title: {
			                    display: true,
			                    text: 'Số lượng món bán ra'
			                }
			            }
			        }
			    }
			});
			// Biểu đồ Xu hướng Doanh thu
			const lineCtx = document.getElementById('revenueLineChart').getContext('2d');
			new Chart(lineCtx, {
			    type: 'line',
			    data: {
			        labels: itemNames,
			        datasets: [
			            {
			                label: 'Doanh thu',
			                data: itemRevenues,
			                borderColor: 'rgba(255, 99, 132, 1)',
			                backgroundColor: 'rgba(255, 99, 132, 0.3)',
			                borderWidth: 2,
			                fill: true
			            }
			        ]
			    },
			    options: {
			        responsive: true,
			        maintainAspectRatio: false,
			        scales: {
			            y: {
			                beginAtZero: true,
			                title: {
			                    display: true,
			                    text: 'Doanh thu'
			                }
			            }
			        }
			    }
			});
			

			  // Biểu đồ doanh thu theo phương thức thanh toán (dạng cột ngang)
	    const paymentCtx = document.getElementById('paymentMethodChart').getContext('2d');
	    new Chart(paymentCtx, {
	        type: 'bar',
	        data: {
	            labels: paymentMethods,
	            datasets: [{
	                label: 'Doanh thu (VNĐ)',
	                data: paymentRevenues,
	                backgroundColor: [
	                    'rgba(75, 192, 192, 0.6)',
	                    'rgba(153, 102, 255, 0.6)',
	                    'rgba(255, 159, 64, 0.6)'
	                ],
	                borderColor: [
	                    'rgba(75, 192, 192, 1)',
	                    'rgba(153, 102, 255, 1)',
	                    'rgba(255, 159, 64, 1)'
	                ],
	                borderWidth: 1
	            }]
	        },
	        options: {
	            responsive: true,
	            indexAxis: 'y', // Biểu đồ cột ngang
	            plugins: {
	                legend: {
	                    display: true,
	                    position: 'top'
	                },
	                tooltip: {
	                    enabled: true
	                }
	            },
	            scales: {
	                x: {
	                    beginAtZero: true,
	                    title: {
	                        display: true,
	                        text: 'Doanh thu (VNĐ)'
	                    }
	                }
	            }
	        }
	    });

		console.log("Days:", days);
		   console.log("Daily Hourly Revenues:", dailyHourlyRevenues);

		   if (days.length > 0 && dailyHourlyRevenues.length > 0) {
		       const ctx = document.getElementById('revenueChart').getContext('2d');

		       const datasets = days.map((day, index) => ({
		           label: `Ngày ${day}`,
		           data: dailyHourlyRevenues[index],
		           borderColor: `hsl(${index * 50}, 70%, 50%)`,
		           backgroundColor: `hsl(${index * 50}, 70%, 80%)`,
		           borderWidth: 2,
		           fill: false
		       }));

		       new Chart(ctx, {
		           type: 'line',
		           data: {
		               labels: [...Array(24).keys()].map(h => `${h}:00`),
		               datasets: datasets
		           },
		           options: {
		               responsive: true,
		               maintainAspectRatio: false,
		               scales: {
		                   y: {
		                       beginAtZero: true,
		                       ticks: {
		                           callback: function(value) {
		                               return value.toLocaleString('vi-VN') + " VND";
		                           }
		                       },
		                       title: {
		                           display: true,
		                           text: 'VNĐ'
		                       }
		                   }
		               }
		           }
		       });
		   } else {
		       console.error("Không có dữ liệu để hiển thị biểu đồ doanh thu theo ngày.");
		   }
		// Hiển thị tổng doanh thu ở phía dưới hoặc bên cạnh
		document.getElementById('totalRevenueByPayment').innerHTML =
		    `Tổng doanh thu từ tất cả phương thức thanh toán: <strong>${totalRevenueByPayment.toLocaleString()} VNĐ</strong>`;


					// Tạo sự kiện để mở/đóng sidebar khi người dùng nhấn nút
	    document.getElementById('toggleSidebar').addEventListener('click', function() {
	        const sidebar = document.querySelector('.sidebar');
	        sidebar.classList.toggle('show');
	    });
	
		// Khi người dùng nhấp vào biểu tượng "!"
		 document.getElementById('showDetails').addEventListener('click', function() {
		     document.getElementById('detailsModal').style.display = 'block';
		 });

		 // Khi người dùng nhấp vào nút đóng
		 document.getElementById('closeModal').addEventListener('click', function() {
		     document.getElementById('detailsModal').style.display = 'none';
		 });
		 // Khi người dùng nhấp vào biểu tượng "!"
 		 document.getElementById('showDetails2').addEventListener('click', function() {
 		     document.getElementById('detailsModal2').style.display = 'block';
 		 });

 		 // Khi người dùng nhấp vào nút đóng
 		 document.getElementById('closeModal2').addEventListener('click', function() {
 		     document.getElementById('detailsModal2').style.display = 'none';
 		 });
		 function toggleDropdown(event, dropdownId) {
		     event.preventDefault(); // Ngăn chặn chuyển trang
		     let item = event.currentTarget.parentElement; // Lấy phần tử cha (li)
		     item.classList.toggle("active"); // Thêm/xóa class active để mở/đóng dropdown
		 }
	</script>
		

	<!-- Thêm Bootstrap CSS và JS (bao gồm jQuery và Popper.js nếu sử dụng phiên bản cũ của Bootstrap) -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
