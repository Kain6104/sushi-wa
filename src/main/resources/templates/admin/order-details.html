<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi tiết đơn hàng</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
    <style>
		.cancel-button[disabled] {
			    cursor: not-allowed; /* Hiển thị biểu tượng cấm */
			    opacity: 0.65;       /* Làm nút mờ đi */
			    pointer-events: none; /* Vô hiệu hóa các sự kiện chuột */
			}

			.payment-summary {
			    background-color: #ffffff;
			    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
			}

			.payment-summary h6 {
			    font-size: 1.1rem;
			    color: #333;
			    margin-bottom: 1rem;
			}

			.payment-summary p {
			    font-size: 0.95rem;
			    margin-bottom: 0.5rem;
			}

			.payment-summary .text-danger {
			    color: #e74c3c;
			}

			.payment-summary .text-success {
			    color: #27ae60;
			}

			.payment-summary .voucher-code {
			    font-weight: bold;
			    color: #d35400;
			}

			.payment-summary .reward-points {
			    font-size: 0.9rem;
			    margin-top: 0.5rem;
			}

			.payment-summary .final-amount {
			    font-size: 1.2rem;
			    margin-top: 1rem;
			}

			.payment-summary .amount {
			    font-size: 1.5rem;
			}

			.action-buttons .btn-warning {
			    background-color: #f39c12;
			    color: #ffffff;
			    font-weight: bold;
			}

			.action-buttons .btn-light {
			    border: 1px solid #ccc;
			    color: #333;
			}

			.action-buttons .btn-danger {
			    background-color: #e74c3c;
			    color: #ffffff;
			}

			.action-buttons .btn-primary {
			    background-color: #3498db;
			    color: #ffffff;
			}
			.used-points {
			    font-size: 14px;
			    background-color: #fff;
			    color: #d9534f; /* Màu đỏ cho chữ */
			    border: 1px solid #d9534f; /* Viền đỏ */
			    padding: 2px 6px; /* Khoảng cách trong */
			    border-radius: 12px; /* Bo tròn */
			    font-weight: bold; /* Chữ đậm */
			    margin-right: 10px; /* Khoảng cách bên phải */
			}

			.text-end {
			    float: right; /* Căn phải giá trị tiền */
			    font-size: 16px;
			    color: rgb(0, 0, 0); /* Màu đỏ */
			}
			.voucher-code {
			    font-size: 14px;
			    background-color: #fff;
			    color: #d9534f; /* Màu đỏ chữ */
			    border: 1px solid #d9534f; /* Viền đỏ */
			    padding: 2px 6px; /* Khoảng cách trong */
			    border-radius: 12px; /* Bo tròn */
			    font-weight: bold; /* Chữ đậm */
			    margin-right: 10px; /* Khoảng cách bên phải */
			}
			.bg-light {
			    background-color: #f8f9fa; /* Màu nền nhạt */
			}

			.badge.bg-success {
			    font-size: 12px;
			    font-weight: bold;
			    border-radius: 20px; /* Bo tròn */
			    line-height: 1.5;
			}

			.text-secondary {
			    color: #6c757d; /* Màu xám nhạt */
			}

			.fw-bold {
			    font-weight: bold;
			}

			.text-primary {
			    color: #007bff; /* Màu xanh chữ link */
			}

			a.text-primary:hover {
			    text-decoration: underline; /* Gạch chân khi hover */
			}
			.product-list2 {
			    overflow-y: auto; /* Hiển thị thanh cuộn nếu nội dung vượt quá */
			    border: 1px solid #ddd; /* Đường viền (tuỳ chọn) */
			    padding: 10px; /* Khoảng cách bên trong (tuỳ chọn) */
			  
			}
			.table-container {
			    max-width: 100%; /* Đặt chiều rộng tối đa, ví dụ: 100% của vùng chứa */
			    overflow-x: auto; /* Hiển thị thanh cuộn ngang nếu nội dung vượt quá */
			    padding: 10px; /* Khoảng cách bên trong (tùy chọn) */
			   
			}
			@media (max-width: 768px) {

			    .payment-summary {
			        background-color: #ffffff;
			        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
			    }

			    .payment-summary h6 {
			        font-size: 1rem; /* Giảm cỡ chữ */
			        color: #333;
			        margin-bottom: 1rem;
			    }

			    .payment-summary p {
			        font-size: 0.85rem; /* Giảm cỡ chữ */
			        margin-bottom: 0.5rem;
			    }

			    .payment-summary .text-danger {
			        color: #e74c3c;
			        font-size: 0.85rem; /* Giảm cỡ chữ */
			    }

			    .payment-summary .text-success {
			        color: #27ae60;
			        font-size: 0.85rem; /* Giảm cỡ chữ */
			    }

			    .payment-summary .voucher-code {
			        font-weight: bold;
			        color: #d35400;
			        font-size: 0.9rem; /* Giảm cỡ chữ */
			    }

			    .payment-summary .reward-points {
			        font-size: 0.8rem; /* Giảm cỡ chữ */
			        margin-top: 0.5rem;
			    }

			    .payment-summary .final-amount {
			        font-size: 1rem; /* Giảm cỡ chữ */
			        margin-top: 1rem;
			    }

			    .payment-summary .amount {
			        font-size: 1.2rem; /* Giảm cỡ chữ */
			    }

			    .action-buttons .btn-warning {
			        background-color: #f39c12;
			        color: #ffffff;
			        font-weight: bold;
			        font-size: 0.85rem; /* Giảm cỡ chữ */
			    }

			    .action-buttons .btn-light {
			        border: 1px solid #ccc;
			        color: #333;
			        font-size: 0.85rem; /* Giảm cỡ chữ */
			    }

			    .action-buttons .btn-danger {
			        background-color: #e74c3c;
			        color: #ffffff;
			        font-size: 0.85rem; /* Giảm cỡ chữ */
			    }

			    .action-buttons .btn-primary {
			        background-color: #3498db;
			        color: #ffffff;
			        font-size: 0.85rem; /* Giảm cỡ chữ */
			    }

			    .used-points {
			        font-size: 0.75rem; /* Giảm cỡ chữ */
			        background-color: #fff;
			        color: #d9534f;
			        border: 1px solid #d9534f;
			        padding: 2px 6px;
			        border-radius: 12px;
			        font-weight: bold;
			        margin-right: 10px;
			    }

			    .text-end {
			        float: right;
			        font-size: 0.85rem; /* Giảm cỡ chữ */
			        color: rgb(0, 0, 0);
			    }

			    .voucher-code {
			        font-size: 0.75rem; /* Giảm cỡ chữ */
			        background-color: #fff;
			        color: #d9534f;
			        border: 1px solid #d9534f;
			        padding: 2px 6px;
			        border-radius: 12px;
			        font-weight: bold;
			        margin-right: 10px;
			    }

			    .bg-light {
			        background-color: #f8f9fa;
			    }

			    .badge.bg-success {
			        font-size: 0.75rem; /* Giảm cỡ chữ */
			        font-weight: bold;
			        border-radius: 20px;
			        line-height: 1.5;
			    }

			    .text-secondary {
			        color: #6c757d;
			        font-size: 0.8rem; /* Giảm cỡ chữ */
			    }

			    .fw-bold {
			        font-weight: bold;
			    }

			    .text-primary {
			        color: #007bff;
			        font-size: 0.8rem; /* Giảm cỡ chữ */
			    }

			    a.text-primary:hover {
			        text-decoration: underline;
			    }

			    .product-list {
			        max-height: 200px;
			        overflow-y: auto;
			        border: 1px solid #ddd;
			        padding: 10px;
			        font-size: 0.85rem; /* Giảm cỡ chữ */
			    }

			    .product-list2 {
			        overflow-y: auto;
			        border: 1px solid #ddd;
			        padding: 10px;
			        font-size: 0.85rem; /* Giảm cỡ chữ */
			    }

			    .table-container {
			        max-width: 100%;
			        overflow-x: auto;
			        padding: 10px;
			        font-size: 0.85rem; /* Giảm cỡ chữ */
			    }
			}
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center">Chi tiết đơn hàng</h1>
		<div th:if="${success}" class="alert alert-success alert-dismissible fade show mt-3" role="alert">
		    <span th:text="${success}"></span>
		    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
		</div>

		<div th:if="${error}" class="alert alert-danger alert-dismissible fade show mt-3" role="alert">
		    <span th:text="${error}"></span>
		    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
		</div>
		<div th:if="${successMessage != null}">
		    <div class="alert alert-success">
		        <span th:text="${successMessage}"></span>
		    </div>
		</div>
	
		<div class="row">
		    <!-- Left Panel -->
		    <div class="col-md-8">
		        <!-- Thông tin đơn hàng -->
				<div class="d-flex align-items-center justify-content-between p-3 bg-light rounded">
				    <div>
						<p class="mb-1">
						    <strong>Mã đơn hàng:</strong> 
						    <span class="text-primary fw-bold" id="order-code" th:text="${order.OrderCode}"></span>
						    <i class="fa fa-copy text-secondary ms-2" id="copy-btn" style="cursor: pointer;" title="Copy"></i>
						</p>
						<p class="mb-1 text-secondary small">
				            <span th:text="${order.getFormattedOrderDate ?: ''}"></span> | <span  th:text="${order.getFormattedDeliveryTime}"></span> 
				        </p>
				    </div>
					<div>
					    <span class="badge text-white px-3 py-2" 
					          th:classappend="${order.status == 'CANCELED' ? 'bg-danger' : (order.status == 'DELIVERING' ? 'bg-primary' : 'bg-success')}"
					          th:text="${order.getStatusDescription}"></span>
					</div>
				</div>
		        <!-- Thông tin khách hàng và người nhận -->
		        <div class="row mb-3">
		            <div class="col-md-6">
		                <div class="card">
		                    <div class="card-body">
		                        <h6 class="card-title fw-bold">Người gửi</h6>
		                        <p class="card-text"><strong>Tên: </strong>Sushi Wa</p>
		                        <p class="card-text"><strong>Số điện thoại: </strong>097 480 2998</p>
		                    </div>
		                </div>
		            </div>
		            <div class="col-md-6">
		                <div class="card">
		                    <div class="card-body">
		                        <h6 class="card-title fw-bold">Khách hàng</h6>
								<p class="card-text"><strong>Username:<a th:href="@{'/admin/customers/details/' + ${order.user.secureToken}}" class="text-decoration-none">
												        <span th:text="${order.username}"></span>
												    </a>		                        </strong> </p>
								<p class="card-text"><strong>Tên:</strong>  <span th:text="${order.name ?: ''}"></span></p>
		                        <p class="card-text"><strong>Số điện thoại:</strong>  <span th:text="${order.phone ?: ''}"></span></p>
		                        <p class="card-text"><strong>Địa chỉ:</strong>  <span th:text="${order.address ?: ''}"></span></p>
		                    </div>
		                </div>
		            </div>
		        </div>
		        <hr>
				<!-- Danh sách sản phẩm -->
				<h6 class="fw-bold mb-3">Danh sách món ăn</h6>
				<div class="product-list">
				    <td colspan="5" th:utext="${order.itemsDescription}"></td>
				</div>
		    </div>
		    <!-- Right Panel -->
			<aside class="col-md-4">
			    <div class="payment-summary border p-3 rounded">
			        <h6 class="fw-bold text-center mb-3">Phương thức thanh toán</h6>
					
					<p>
					    <strong>
					       
					        <span class="text-end" th:text="${order.formattedTotalAmount} + 'đ'"></span>
					    </strong>
					    <span th:if="${order.paymentMethod == 'momo'}">
					        <img src="https://upload.wikimedia.org/wikipedia/vi/f/fe/MoMo_Logo.png" alt="Momo" style="width: 24px; height: 24px; margin-left: 8px;">
					    </span>
						<span th:if="${order.paymentMethod == 'cod'}">
					        <img src="https://megabus.vn/wp-content/uploads/2020/02/tien-mat-megabus.png" alt="Tiền mặt" title="Tiền mặt" style="width: 24px; height: 24px; margin-left: 8px;">
					    </span>
						<span th:if="${order.paymentMethod == 'vietqr'}">
					        <img src="https://ps.w.org/thanh-toan-chuyen-khoan-ngan-hang-voi-vietqr/assets/icon-256x256.png?rev=3014887" alt="Momo" style="width: 50px; height: 50px; margin-left: 8px;">
					    </span>
					</p>								        
					<hr>
			        <p><strong>Tạm tính:</strong> <span class="text-end fw-bold" th:text="${order.formattedTotalPrice ?: ''}+'đ'"></span></p>
			       
					<p class="reward-points "></p>
			        <p><strong>Phí vận chuyển:</strong> <span class="text-end text-success">Miễn phí</span></p>
					<p>
					    <strong>Mã giảm giá:</strong> 
					    <span class="badge text-danger border border-danger fw-bold" th:text="${order.voucherCode ?: 'Không dùng'}"></span>
					    <span class="text-end fw-bold" th:text="'-'+${order.formattedVoucherDiscount ?: '0đ'}+'đ'"></span>
					</p>
					<hr style="margin-top: 100px; border-top: 2px dashed #000;">
					<p>
					    <strong>Dùng điểm:</strong> 
					    <span class="badge text-danger border border-danger fw-bold" th:text="${order.pointsUsed} + ' POINT'"></span>
					    <span class="text-end fw-bold" th:text="'-' + (${order.getFormattedPoints}) + 'đ'"></span>
					</p>
			        <hr>
			        <p class="final-amount">
						<div th:if="${order.status != 'CANCELED'}">
						    <strong>Đã thanh toán:</strong>
						    <span class="amount text-danger fw-bold" th:text="${order.formattedTotalAmount} + 'đ'"></span>
						</div>
						<div th:if="${order.status == 'CANCELED'}">
							<strong>Trạng thái:</strong>
						    <span class="text-danger fw-bold">ĐƠN HÀNG ĐÃ HỦY</span>
						</div>
						<div th:if="${order.status == 'CANCELED'}"> 
						    <strong>Hủy bởi:</strong>
						    <span th:text="${order.canceledBy == 'USER' ? 'Người dùng' : 'Quản trị viên'}"></span>
						    <span th:if="${order.cancelReason}">
						        (<span th:text="${order.cancelReason}"></span>)
						    </span>
						</div>
						
						<p class="reward-points" 
						   th:classappend="${order.status == 'CANCELED' ? 'text-danger' : 'text-success'}">
						    <span th:text="${order.status == 'CANCELED' ? '+0 điểm' : '+' + order.formattedRewardPoints + ' điểm'}"></span>
						</p>
			        </p>
			       
			    </div>
				<div class="action-buttons text-center mt-3">
				    <div class="d-flex justify-content-center gap-3">
				        <button type="button" class="btn btn-outline-secondary position-relative">
				            Ghi chú
				            <span class="badge bg-danger position-absolute top-0 start-100 translate-middle">
				                2
				            </span>
				        </button>
				        <button type="button" class="btn btn-outline-secondary">Sửa đơn</button>
						<!-- Nút Hủy đơn (chỉ hiển thị nếu trạng thái là PENDING) -->
						<!-- Nút mở modal Hủy đơn hàng -->
						<button type="button" 
						        class="btn btn-danger" 
						        data-bs-toggle="modal" 
						        data-bs-target="#adminCancelOrderModal">
						    Hủy đơn hàng
						</button>
						<form th:action="@{/admin/orders/reorder/{orderCode}(orderCode=${order.OrderCode})}" method="post">
						    <button type="submit">Đặt lại đơn hàng</button>
						</form>
				    </div>
				</div>
			</aside>
		</div>
		<!-- Modal Hủy đơn hàng bởi Admin -->
		<div class="modal fade" id="adminCancelOrderModal" tabindex="-1" aria-labelledby="adminCancelOrderModalLabel" aria-hidden="true">
		    <div class="modal-dialog">
		        <div class="modal-content">
		            <div class="modal-header">
		                <h5 class="modal-title" id="adminCancelOrderModalLabel">Hủy đơn hàng bởi Quản trị viên</h5>
		                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		            </div>
		            <div class="modal-body">
		                <p>Bạn đang hủy đơn hàng <strong th:text="${order.orderCode}"></strong>.</p>
		                <form th:action="@{/admin/orders/cancel/{orderCode}(orderCode=${order.orderCode})}" method="post">
		                    <div class="mb-3">
		                        <label for="adminReason" class="form-label"><strong>Lý do hủy:</strong></label>
		                        <textarea class="form-control" id="adminReason" name="adminReason" rows="3" placeholder="Nhập lý do hủy đơn" required></textarea>
		                    </div>
		                    <div class="modal-footer">
		                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
		                        <button type="submit" class="btn btn-danger">Xác nhận hủy</button>
		                    </div>
		                </form>
		            </div>
		        </div>
		    </div>
		</div>
		<a th:if="${order.status == 'DELIVERING'}" th:href="@{'/admin/orders/confirm/' + ${order.orderCode}}" class="btn btn-primary">Đã giao hàng</a>
		               <!-- Nút giao hàng -->
		               <a th:if="${order.status == 'PENDING'}" th:href="@{'/admin/orders/deliver/' + ${order.orderCode}}" class="btn btn-outline-success">Bắt đầu giao hàng</a>
					
		<a href="javascript:history.back()" class="btn btn-secondary mt-4">Quay lại</a>
	</div>
    </div>
	<script>
	    document.getElementById('copy-btn').addEventListener('click', function() {
	        const orderCode = document.getElementById('order-code').textContent; // Lấy mã đơn hàng
	        navigator.clipboard.writeText(orderCode).then(() => {
	            alert('Đã sao chép mã đơn hàng: ' + orderCode); // Thông báo khi copy thành công
	        }).catch(err => {
	            alert('Không thể sao chép: ' + err); // Thông báo khi có lỗi
	        });
	    });
	</script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
